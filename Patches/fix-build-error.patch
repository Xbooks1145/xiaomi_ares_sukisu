From 8870f112b2e69ab041125eff3114a2a86c1e9921 Mon Sep 17 00:00:00 2001
From: MerCuJerry <mercujerry@gmail.com>
Date: Tue, 2 Sep 2025 19:11:36 +0800
Subject: [PATCH] fix: fix build error while using clang

---
 Makefile                                      |  22 +++-
 arch/arm64/kernel/hwconf_manager.c            |   2 +-
 drivers/block/zram/zram_drv.c                 |   2 +-
 .../focaltech_spi/focaltech_core.c            |   2 +-
 .../input/touchscreen/xiaomi/xiaomi_touch.c   |   6 +-
 .../base/power/eem_v2/mt6893/mtk_eem.c        |   4 +-
 .../misc/mediatek/c2k_usb/viatel_rawbulk.h    |   8 +-
 .../bt/mt66xx/connac2/btmtk_btif_main.c       | 100 +++++++++---------
 .../conninfra/drv_init/bluetooth_drv_init.c   |   2 +-
 .../conninfra/drv_init/fm_drv_init.c          |   2 +-
 .../conninfra/drv_init/wlan_drv_init.c        |   4 +-
 .../platform/mt6893/mt6893_consys_reg.c       |   2 +-
 .../conninfra/src/conninfra_dev.c             |   2 +-
 .../mtk_platform_common/mtk_mfg_counter.c     |   2 +-
 .../ov64b40sunnymipiraw_Sensor.c              |   2 +-
 drivers/misc/mediatek/perf/perf_tracker.c     |   4 +-
 .../thermal/common/coolers/mtk_cooler_atm.c   |   2 +-
 .../typec/tcpc_ares/pd_dpm_alt_mode_dp.c      |   3 +-
 18 files changed, 95 insertions(+), 76 deletions(-)

diff --git a/Makefile b/Makefile
index 861a02721..11d48f875 100644
--- a/Makefile
+++ b/Makefile
@@ -368,8 +368,13 @@ HOST_LFS_CFLAGS := $(shell getconf LFS_CFLAGS 2>/dev/null)
 HOST_LFS_LDFLAGS := $(shell getconf LFS_LDFLAGS 2>/dev/null)
 HOST_LFS_LIBS := $(shell getconf LFS_LIBS 2>/dev/null)
 
+ifneq ($(LLVM),)
+HOSTCC       = clang
+HOSTCXX      = clang++
+else
 HOSTCC       = gcc
 HOSTCXX      = g++
+endif
 HOSTCFLAGS   := -Wall -Wmissing-prototypes -Wstrict-prototypes -O2 \
 		-fomit-frame-pointer -std=gnu89 $(HOST_LFS_CFLAGS)
 HOSTCXXFLAGS := -O2 $(HOST_LFS_CFLAGS)
@@ -377,16 +382,28 @@ HOSTLDFLAGS  := $(HOST_LFS_LDFLAGS)
 HOST_LOADLIBES := $(HOST_LFS_LIBS)
 
 # Make variables (CC, etc...)
+LDGOLD		= $(CROSS_COMPILE)ld.gold
+CPP		= $(CC) -E
+ifneq ($(LLVM),)
+CC		= clang
+LD		= ld.lld
+AR		= llvm-ar
+NM		= llvm-nm
+OBJCOPY	= llvm-objcopy
+OBJDUMP	= llvm-objdump
+READELF	= llvm-readelf
+OBJSIZE	= llvm-size
+STRIP		= llvm-strip
+else
 AS		= $(CROSS_COMPILE)as
 LD		= $(CROSS_COMPILE)ld
-LDGOLD		= $(CROSS_COMPILE)ld.gold
 CC		= $(CROSS_COMPILE)gcc
-CPP		= $(CC) -E
 AR		= $(CROSS_COMPILE)ar
 NM		= $(CROSS_COMPILE)nm
 STRIP		= $(CROSS_COMPILE)strip
 OBJCOPY		= $(CROSS_COMPILE)objcopy
 OBJDUMP		= $(CROSS_COMPILE)objdump
+endif
 AWK		= awk
 GENKSYMS	= scripts/genksyms/genksyms
 INSTALLKERNEL  := installkernel
@@ -428,6 +445,7 @@ KBUILD_CFLAGS   := -Wall -Wundef -Wstrict-prototypes -Wno-trigraphs \
 		   -fno-strict-aliasing -fno-common -fshort-wchar \
 		   -Werror-implicit-function-declaration \
 		   -Wno-format-security \
+		   -Wno-default-const-init-var-unsafe \
 		   -std=gnu89
 KBUILD_CPPFLAGS := -D__KERNEL__
 KBUILD_AFLAGS_KERNEL :=
diff --git a/arch/arm64/kernel/hwconf_manager.c b/arch/arm64/kernel/hwconf_manager.c
index 31abdad23..6c27fc934 100755
--- a/arch/arm64/kernel/hwconf_manager.c
+++ b/arch/arm64/kernel/hwconf_manager.c
@@ -210,7 +210,7 @@ static char *hw_item_print(hw_item *item, int ident, int *offset)
 	return print_buf;
 }
 
-static char *hw_item_dump()
+static char *hw_item_dump(void)
 {
 	int offset = 0;
 	memset(print_buf, 0, PAGE_SIZE);
diff --git a/drivers/block/zram/zram_drv.c b/drivers/block/zram/zram_drv.c
index 938817b96..d9c472d6a 100644
--- a/drivers/block/zram/zram_drv.c
+++ b/drivers/block/zram/zram_drv.c
@@ -1044,7 +1044,7 @@ static void free_pages_life(struct zram_pages_life *pl)
 	}
 }
 
-static struct zram_pages_life *init_pages_life()
+static struct zram_pages_life *init_pages_life(void)
 {
 	size_t i = 0;
 	struct zram_pages_life *pl = NULL;
diff --git a/drivers/input/touchscreen/focaltech_spi/focaltech_core.c b/drivers/input/touchscreen/focaltech_spi/focaltech_core.c
index 8d7c3d801..c7ced057e 100644
--- a/drivers/input/touchscreen/focaltech_spi/focaltech_core.c
+++ b/drivers/input/touchscreen/focaltech_spi/focaltech_core.c
@@ -2112,7 +2112,7 @@ static void fts_restore_mode_value(int mode, int value_type)
 		xiaomi_touch_interfaces.touch_mode[mode][value_type];
 }
 
-static void fts_restore_normal_mode()
+static void fts_restore_normal_mode(void)
 {
 	int i;
 	int temp_value;
diff --git a/drivers/input/touchscreen/xiaomi/xiaomi_touch.c b/drivers/input/touchscreen/xiaomi/xiaomi_touch.c
index ed942436c..f2f7b3ae3 100644
--- a/drivers/input/touchscreen/xiaomi/xiaomi_touch.c
+++ b/drivers/input/touchscreen/xiaomi/xiaomi_touch.c
@@ -178,13 +178,13 @@ struct xiaomi_touch *xiaomi_touch_dev_get(int minor)
 		return NULL;
 }
 
-struct class *get_xiaomi_touch_class()
+struct class *get_xiaomi_touch_class(void)
 {
 	return xiaomi_touch_dev.class;
 }
 EXPORT_SYMBOL_GPL(get_xiaomi_touch_class);
 
-struct device *get_xiaomi_touch_dev()
+struct device *get_xiaomi_touch_dev(void)
 {
 	return xiaomi_touch_dev.dev;
 }
@@ -465,7 +465,7 @@ int copy_touch_rawdata(char *raw_base,  int len)
 }
 EXPORT_SYMBOL_GPL(copy_touch_rawdata);
 
-int update_touch_rawdata()
+int update_touch_rawdata(void)
 {
 	sysfs_notify(&xiaomi_touch_dev.dev->kobj, NULL,  "update_rawdata");
 
diff --git a/drivers/misc/mediatek/base/power/eem_v2/mt6893/mtk_eem.c b/drivers/misc/mediatek/base/power/eem_v2/mt6893/mtk_eem.c
index 4f33cf691..babeee9af 100644
--- a/drivers/misc/mediatek/base/power/eem_v2/mt6893/mtk_eem.c
+++ b/drivers/misc/mediatek/base/power/eem_v2/mt6893/mtk_eem.c
@@ -251,7 +251,7 @@ static int eem_aee_log_cur_volt(struct eem_det *det)
 	/* fill data to aee_log_buf */
 	if ((str_len > 0) &&
 		((cur_oft + str_len) < PTP_MEM_SIZE) &&
-		det->ctrl_id >= 0 && det->ctrl_id < NR_EEM_DET) {
+		det->ctrl_id >= 0 && det->ctrl_id < (enum eem_ctrl_id)NR_EEM_DET) {
 		memcpy(aee_volt->aee_v_det[det->ctrl_id].dumpbuf +
 			cur_oft, aee_log_buf, str_len + 1);
 		cur_oft += str_len;
@@ -286,7 +286,7 @@ static int eem_aee_log_cur_volt(struct eem_det *det)
 		/* fill data to aee_log_buf */
 		if ((str_len > 0) &&
 			((cur_oft + str_len) < PTP_MEM_SIZE) &&
-			det->ctrl_id >= 0 && det->ctrl_id < NR_EEM_DET) {
+			det->ctrl_id >= 0 && det->ctrl_id < (enum eem_ctrl_id)NR_EEM_DET) {
 			memcpy(aee_volt->aee_v_det[det->ctrl_id].dumpbuf +
 			cur_oft, aee_log_buf, str_len + 1);
 			cur_oft += str_len;
diff --git a/drivers/misc/mediatek/c2k_usb/viatel_rawbulk.h b/drivers/misc/mediatek/c2k_usb/viatel_rawbulk.h
index 1720b60fb..beabb677e 100644
--- a/drivers/misc/mediatek/c2k_usb/viatel_rawbulk.h
+++ b/drivers/misc/mediatek/c2k_usb/viatel_rawbulk.h
@@ -76,11 +76,11 @@ struct rawbulk_function {
 
 	/* Controls */
 	spinlock_t lock;
-	int enable:1;
-	int activated:1;	/* set when usb enabled */
-	int tty_opened:1;
+	unsigned int enable:1;
+	unsigned int activated:1;	/* set when usb enabled */
+	unsigned int tty_opened:1;
 
-	int initialized:1;	/* init-flag for activator worker */
+	unsigned int initialized:1;	/* init-flag for activator worker */
 	struct work_struct activator;	/* asynic transaction starter */
 
 	struct wakeup_source keep_awake;
diff --git a/drivers/misc/mediatek/connectivity/bt/mt66xx/connac2/btmtk_btif_main.c b/drivers/misc/mediatek/connectivity/bt/mt66xx/connac2/btmtk_btif_main.c
index 8b99af3ad..de1f7e782 100644
--- a/drivers/misc/mediatek/connectivity/bt/mt66xx/connac2/btmtk_btif_main.c
+++ b/drivers/misc/mediatek/connectivity/bt/mt66xx/connac2/btmtk_btif_main.c
@@ -22,13 +22,13 @@
 
 #include "conninfra.h"
 #include "mtk_btif_exp.h"
-#include "connectivity_build_in_adapter.h"
+#include "connectivity_build_in_adapter.h"
 #include "btmtk_config.h"
 #include "btmtk_define.h"
 #include "btmtk_main.h"
 #include "btmtk_btif.h"
 #include "btmtk_mt66xx_reg.h"
-
+
 #if SUPPORT_COREDUMP
 #include "connsys_debug_utility.h"
 #endif
@@ -211,48 +211,48 @@ static void btmtk_fb_notify_unregister(void)
 	fb_unregister_client(&bt_fb_notifier);
 }
 
-/* btmtk_cif_dump_fw_no_rsp
- *
- *    Dump fw/driver own cr and btif cr if
- *    fw response timeout
- *
- * Arguments:
- *
- *
- * Return Value:
- *     N/A
- *
- */
-void btmtk_cif_dump_fw_no_rsp(unsigned int flag)
-{
-	BTMTK_WARN("%s! [%u]", __func__, flag);
-	if (!g_btif_id) {
-		BTMTK_ERR("NULL BTIF ID reference!");
-	} else {
-		if (flag & BT_BTIF_DUMP_OWN_CR)
-			bt_dump_cif_own_cr();
-
-		if (flag & BT_BTIF_DUMP_REG)
-			mtk_wcn_btif_dbg_ctrl(g_btif_id, BTIF_DUMP_BTIF_REG);
-
-		if (flag & BT_BTIF_DUMP_LOG)
+/* btmtk_cif_dump_fw_no_rsp
+ *
+ *    Dump fw/driver own cr and btif cr if
+ *    fw response timeout
+ *
+ * Arguments:
+ *
+ *
+ * Return Value:
+ *     N/A
+ *
+ */
+void btmtk_cif_dump_fw_no_rsp(unsigned int flag)
+{
+	BTMTK_WARN("%s! [%u]", __func__, flag);
+	if (!g_btif_id) {
+		BTMTK_ERR("NULL BTIF ID reference!");
+	} else {
+		if (flag & BT_BTIF_DUMP_OWN_CR)
+			bt_dump_cif_own_cr();
+
+		if (flag & BT_BTIF_DUMP_REG)
+			mtk_wcn_btif_dbg_ctrl(g_btif_id, BTIF_DUMP_BTIF_REG);
+
+		if (flag & BT_BTIF_DUMP_LOG)
 			mtk_wcn_btif_dbg_ctrl(g_btif_id, BTIF_DUMP_LOG);
 
 		if (flag & BT_BTIF_DUMP_DMA)
 			mtk_wcn_btif_dbg_ctrl(g_btif_id, BTIF_DUMP_DMA_VFIFO);
 
-	}
-}
-
-
-void btmtk_cif_dump_rxd_backtrace(void)
-{
-	if (!g_btif_rxd_thread)
-		BTMTK_ERR("g_btif_rxd_thread == NULL");
-	else
-		KERNEL_show_stack(g_btif_rxd_thread, NULL);
-}
-
+	}
+}
+
+
+void btmtk_cif_dump_rxd_backtrace(void)
+{
+	if (!g_btif_rxd_thread)
+		BTMTK_ERR("g_btif_rxd_thread == NULL");
+	else
+		KERNEL_show_stack(g_btif_rxd_thread, NULL);
+}
+
 
 /* btmtk_cif_dump_btif_tx_no_rsp
  *
@@ -574,19 +574,19 @@ static int32_t bt_do_calibration(void)
 	}
 
 	ret = btmtk_calibration_flow(g_bdev->hdev);
-	/* return -1 means driver unable to recv calibration event and reseting
-	 * In such case, we don't have to turn off bt, it will be handled by 
-	 * reset thread */
+	/* return -1 means driver unable to recv calibration event and reseting
+	 * In such case, we don't have to turn off bt, it will be handled by 
+	 * reset thread */
 	if (ret != -1 && g_bdev->bt_precal_state == FUNC_OFF)
 		btmtk_set_power_off(g_bdev->hdev, TRUE);
 
 	if (ret == -1) {
 		BTMTK_ERR("%s: error return in recving calibration event, reset", __func__);
-		return CONNINFRA_CB_RET_CAL_FAIL_POWER_ON;
-	} else if (ret) {
+		return CONNINFRA_CB_RET_CAL_FAIL_POWER_ON;
+	} else if (ret) {
 		BTMTK_ERR("%s: error return in sent calibration cmd", __func__);
-		return (g_bdev->bt_precal_state) ? CONNINFRA_CB_RET_CAL_FAIL_POWER_ON :
-						   CONNINFRA_CB_RET_CAL_FAIL_POWER_OFF;
+		return (g_bdev->bt_precal_state) ? CONNINFRA_CB_RET_CAL_FAIL_POWER_ON :
+						   CONNINFRA_CB_RET_CAL_FAIL_POWER_OFF;
 	} else
 		return (g_bdev->bt_precal_state) ? CONNINFRA_CB_RET_CAL_PASS_POWER_ON :
 						   CONNINFRA_CB_RET_CAL_PASS_POWER_OFF;
@@ -765,9 +765,9 @@ int32_t btmtk_btif_open(void)
 		mtk_wcn_btif_close(g_btif_id);
 		return -1;
 	}
-
-	g_btif_rxd_thread = mtk_btif_exp_rx_thread_get(g_btif_id);
-
+
+	g_btif_rxd_thread = mtk_btif_exp_rx_thread_get(g_btif_id);
+
 #if SUPPORT_BT_THREAD
 	/* 3. Enter deeple idle */
 	ret = mtk_wcn_btif_dpidle_ctrl(g_btif_id, TRUE);
@@ -792,7 +792,7 @@ int32_t btmtk_btif_open(void)
  * Return Value:
  *     0 if success, otherwise error code
  */
-int32_t btmtk_btif_close()
+int32_t btmtk_btif_close(void)
 {
 	int32_t ret = 0;
 
diff --git a/drivers/misc/mediatek/connectivity/conninfra/drv_init/bluetooth_drv_init.c b/drivers/misc/mediatek/connectivity/conninfra/drv_init/bluetooth_drv_init.c
index ec4b05641..7e385f37b 100644
--- a/drivers/misc/mediatek/connectivity/conninfra/drv_init/bluetooth_drv_init.c
+++ b/drivers/misc/mediatek/connectivity/conninfra/drv_init/bluetooth_drv_init.c
@@ -7,7 +7,7 @@
 #include "bluetooth_drv_init.h"
 
 #ifdef CONFIG_MTK_COMBO_BT
-int __attribute__((weak)) mtk_wcn_stpbt_drv_init()
+int __attribute__((weak)) mtk_wcn_stpbt_drv_init(void)
 {
 	pr_info("Not implement mtk_wcn_stpbt_drv_init\n");
 	return 0;
diff --git a/drivers/misc/mediatek/connectivity/conninfra/drv_init/fm_drv_init.c b/drivers/misc/mediatek/connectivity/conninfra/drv_init/fm_drv_init.c
index 35d512408..6347ca8d8 100644
--- a/drivers/misc/mediatek/connectivity/conninfra/drv_init/fm_drv_init.c
+++ b/drivers/misc/mediatek/connectivity/conninfra/drv_init/fm_drv_init.c
@@ -8,7 +8,7 @@
 #include "fm_drv_init.h"
 
 #ifdef CONFIG_MTK_FMRADIO
-int __attribute__((weak)) mtk_wcn_fm_init()
+int __attribute__((weak)) mtk_wcn_fm_init(void)
 {
 	pr_err("no impl. mtk_wcn_fm_init\n");
 	return 0;
diff --git a/drivers/misc/mediatek/connectivity/conninfra/drv_init/wlan_drv_init.c b/drivers/misc/mediatek/connectivity/conninfra/drv_init/wlan_drv_init.c
index d62c7fc9b..b41e38400 100644
--- a/drivers/misc/mediatek/connectivity/conninfra/drv_init/wlan_drv_init.c
+++ b/drivers/misc/mediatek/connectivity/conninfra/drv_init/wlan_drv_init.c
@@ -7,13 +7,13 @@
 
 #include "wlan_drv_init.h"
 
-int __attribute__((weak)) mtk_wcn_wlan_gen4_init()
+int __attribute__((weak)) mtk_wcn_wlan_gen4_init(void)
 {
 	pr_info("no impl. mtk_wcn_wlan_gen4_init\n");
 	return 0;
 }
 
-int __attribute__((weak)) mtk_wcn_wmt_wifi_init()
+int __attribute__((weak)) mtk_wcn_wmt_wifi_init(void)
 {
 	pr_info("no impl. mtk_wcn_wmt_wifi_init");
 	return 0;
diff --git a/drivers/misc/mediatek/connectivity/conninfra/platform/mt6893/mt6893_consys_reg.c b/drivers/misc/mediatek/connectivity/conninfra/platform/mt6893/mt6893_consys_reg.c
index e8187e458..1b41679e9 100644
--- a/drivers/misc/mediatek/connectivity/conninfra/platform/mt6893/mt6893_consys_reg.c
+++ b/drivers/misc/mediatek/connectivity/conninfra/platform/mt6893/mt6893_consys_reg.c
@@ -71,7 +71,7 @@ struct consys_reg_mng_ops* get_consys_reg_mng_ops(void)
 	return &g_dev_consys_reg_ops;
 }
 
-struct consys_base_addr* get_conn_reg_base_addr()
+struct consys_base_addr* get_conn_reg_base_addr(void)
 {
 	return &conn_reg;
 }
diff --git a/drivers/misc/mediatek/connectivity/conninfra/src/conninfra_dev.c b/drivers/misc/mediatek/connectivity/conninfra/src/conninfra_dev.c
index b0279174e..26a72e09d 100755
--- a/drivers/misc/mediatek/connectivity/conninfra/src/conninfra_dev.c
+++ b/drivers/misc/mediatek/connectivity/conninfra/src/conninfra_dev.c
@@ -478,7 +478,7 @@ static void conninfra_register_pmic_callback(void)
 
 
 /************************************************************************/
-static int conninfra_dev_do_drv_init()
+static int conninfra_dev_do_drv_init(void)
 {
 	static int init_done = 0;
 	int iret = 0;
diff --git a/drivers/misc/mediatek/gpu/gpu_mali/mali_valhall/mali-r32p1/drivers/gpu/arm/midgard/platform/mtk_platform_common/mtk_mfg_counter.c b/drivers/misc/mediatek/gpu/gpu_mali/mali_valhall/mali-r32p1/drivers/gpu/arm/midgard/platform/mtk_platform_common/mtk_mfg_counter.c
index 537487a81..967d8715c 100644
--- a/drivers/misc/mediatek/gpu/gpu_mali/mali_valhall/mali-r32p1/drivers/gpu/arm/midgard/platform/mtk_platform_common/mtk_mfg_counter.c
+++ b/drivers/misc/mediatek/gpu/gpu_mali/mali_valhall/mali-r32p1/drivers/gpu/arm/midgard/platform/mtk_platform_common/mtk_mfg_counter.c
@@ -769,7 +769,7 @@ void mtk_mfg_counter_destroy(void)
 
 
 // init but don't enable met
-int gator_gpu_pmu_init()
+int gator_gpu_pmu_init(void)
 {
 	int ret = PMU_OK;
 	int i, j, cnt, block_type;
diff --git a/drivers/misc/mediatek/imgsensor/src/common/v1_1/ov64b40sunny_mipi_raw/ov64b40sunnymipiraw_Sensor.c b/drivers/misc/mediatek/imgsensor/src/common/v1_1/ov64b40sunny_mipi_raw/ov64b40sunnymipiraw_Sensor.c
index 0b93e4094..4b24ab2cc 100755
--- a/drivers/misc/mediatek/imgsensor/src/common/v1_1/ov64b40sunny_mipi_raw/ov64b40sunnymipiraw_Sensor.c
+++ b/drivers/misc/mediatek/imgsensor/src/common/v1_1/ov64b40sunny_mipi_raw/ov64b40sunnymipiraw_Sensor.c
@@ -914,7 +914,7 @@ static void capture_setting(kal_uint16 currefps)
 }	/*	preview_setting  */
 
 
-static void normal_video_setting()
+static void normal_video_setting(void)
 {
 	LOG_INF("E!\n");
 
diff --git a/drivers/misc/mediatek/perf/perf_tracker.c b/drivers/misc/mediatek/perf/perf_tracker.c
index 008a482ee..665de791c 100644
--- a/drivers/misc/mediatek/perf/perf_tracker.c
+++ b/drivers/misc/mediatek/perf/perf_tracker.c
@@ -188,12 +188,12 @@ u32 __attribute__((weak)) qos_sram_read(u32 offset)
 	return 0;
 }
 
-int __attribute__((weak)) get_cur_vcore_uv()
+int __attribute__((weak)) get_cur_vcore_uv(void)
 {
 	return 0;
 }
 
-int __attribute__((weak)) get_cur_ddr_khz()
+int __attribute__((weak)) get_cur_ddr_khz(void)
 {
 	return 0;
 }
diff --git a/drivers/misc/mediatek/thermal/common/coolers/mtk_cooler_atm.c b/drivers/misc/mediatek/thermal/common/coolers/mtk_cooler_atm.c
index 4ba45c703..9b5c57540 100644
--- a/drivers/misc/mediatek/thermal/common/coolers/mtk_cooler_atm.c
+++ b/drivers/misc/mediatek/thermal/common/coolers/mtk_cooler_atm.c
@@ -3890,7 +3890,7 @@ static int krtatm_thread(void *arg)
 }
 #endif	/* FAST_RESPONSE_ATM */
 
-static void init_ctm_param()
+static void init_ctm_param(void)
 {
 	int t_K_SUM_TT_HIGH = CLCTM_TT_HIGH;
 	int t_K_SUM_TT_LOW = CLCTM_TT_LOW;
diff --git a/drivers/misc/mediatek/typec/tcpc_ares/pd_dpm_alt_mode_dp.c b/drivers/misc/mediatek/typec/tcpc_ares/pd_dpm_alt_mode_dp.c
index 84733d809..760a14494 100644
--- a/drivers/misc/mediatek/typec/tcpc_ares/pd_dpm_alt_mode_dp.c
+++ b/drivers/misc/mediatek/typec/tcpc_ares/pd_dpm_alt_mode_dp.c
@@ -349,7 +349,8 @@ static inline uint8_t dp_dfp_u_select_mode(struct pd_port *pd_port,
 	struct svdm_mode *remote, *local;
 	int i, j;
 	int match_score, best_match_score = 0;
-	int local_index = -1, remote_index = -1;
+	int __maybe_unused local_index = -1;
+	int remote_index = -1;
 	struct tcpc_device __maybe_unused *tcpc = pd_port->tcpc;
 
 	local = &svid_data->local_mode;
-- 
2.51.0

